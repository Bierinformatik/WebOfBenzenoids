<!doctype html>
<html>
	<head>
		<title>MathOfBenzenoids</title>
		<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	</head>
	<body>
		
		<button id="calcbutton">CALCULATE</button>
		<textarea id="coordinates"></textarea>
		
		<canvas id="canvas" width="500" height="500"></canvas>

		<script type="text/javascript">

		 function drawHex(cxt, size, x, y)
		 {
			 var numberOfSides = 6,
				 size = size,
				 Xcenter = x,
				 Ycenter = y;
			 
			 cxt.beginPath();
			 cxt.moveTo (Xcenter + size * Math.cos(0), Ycenter + size *  Math.sin(0));          
			 
			 for (var i = 1; i <= numberOfSides;i += 1) {
				 cxt.lineTo (Xcenter + size * Math.cos(i * 2 * Math.PI / numberOfSides), Ycenter + size * Math.sin(i * 2 * Math.PI / numberOfSides));
			 }

			 cxt.strokeStyle = "#000000";
			 cxt.lineWidth = 1;
			 cxt.stroke();
		 }

		 var filledHexImage = new Image();
		 filledHexImage.onload = function() {
		 };

		 var emptyHexImage = new Image();
		 emptyHexImage.onload = function() {
		 };

		 var highlightHexImage = new Image();
		 highlightHexImage.onload = function() {
		 };

		 filledHexImage.src = "static/images/filledhex.png";
		 emptyHexImage.src = "static/images/emptyhex.png";
		 highlightHexImage.src = "static/images/highlighthex.png";

		 var filledHexImages = [];

		 for (var i=1;i<12;i++)
			 {
				 var img = new Image();
				 img.onload = function() {
				 };
				 img.src = "static/images/filled" + i + ".png";
				 filledHexImages.push(img);
			 }

		 var body = document.body,
			 html = document.documentElement;

		 var height = Math.max( body.scrollHeight, body.offsetHeight, 
								html.clientHeight, html.scrollHeight, html.offsetHeight );
		 var width = Math.max( body.scrollWidth, body.offsetWidth, 
							   html.clientWidth, html.scrollWidth, html.offsetWidth );

		 var boardw = Math.floor(width / 16.5);
		 var boardh = Math.floor(height / 16);

		 x = 0;
		 y = 0;
		 z = 0;
		 w = width;
		 h = height;
		 var canvas = document.getElementById('canvas');
		 var context = canvas.getContext("2d");
		 canvas.width = w;
		 canvas.height = h;
		 canvas.style.width = w+"px";
		 canvas.style.height = h+"px";
		 canvas.style.position = "absolute";
		 canvas.style.left = x+"px";
		 canvas.style.top = y+"px";
		 canvas.style.zIndex = z;

		 var calcbutton = document.getElementById('calcbutton');
		 calcbutton.style.position = "absolute";
		 calcbutton.style.left = 20+"px";
		 calcbutton.style.top = (height - 50) +"px";
		 calcbutton.style.zIndex = 10;

		 var posfield = document.getElementById('coordinates');
		 posfield.style.position = "absolute";
		 posfield.style.left = 200+"px";
		 posfield.style.width = 400+"px";
		 posfield.style.top = (height - 50) +"px";
		 posfield.style.zIndex = 10;
		 
		 var board = [];

		 var i=0,j=0;
		 for(i=0; i<boardw; i++)
			 {
				 board[i] = [];
				 for(j=0; j<boardh; j++)
					 {
						 board[i][j] = 0;
					 }
			 }

		 var highlight = {x: 0, y: 0};

		 function wrap(c, boardc)
		 {
			 if (c < 0)
				 {
					 return boardc + c;
				 }

			 if (c >= boardc)
				 {
					 return c % boardc;
				 }

			 return c;
		 }


		 function clamp(c, boardc)
		 {
			 if (c < 0)
				 {
					 return 0;
				 }

			 if (c >= boardc)
				 {
					 return boardc - 1;
				 }

			 return c;
		 }

		 function pixelToTile(px, py, boardw, boardh, func)
		 {
			 var tiley = Math.floor((py - 5) / 14);
			 var tilex = Math.floor((px - (tiley % 2) * 8) / 16);

			 tilex = func(tilex, boardw);
			 tiley = func(tiley, boardh);

			 var x = tilex * 16 + (tiley % 2) * 8;
			 var y = tiley * 14;

			 return {x: x, y: y, tilex: tilex, tiley: tiley};
			 
		 }

		 var buttonDown = false;
		 var preventClick = false;

		 canvas.addEventListener('mousedown', function(evt)
			 {
				 buttonDown = true;
			 }, false);

		 canvas.addEventListener('mouseup', function(evt)
			 {
				 highlight = pixelToTile(evt.layerX, evt.layerY, boardw, boardh, clamp);
				 if (highlight && !preventClick)
					 {
						 board[highlight.tilex][highlight.tiley] = !board[highlight.tilex][highlight.tiley];
					 }

				 preventClick = false;
				 buttonDown = false;        
			 }, false);

		 canvas.addEventListener('mousemove', function(evt)
			 {
				 highlight = pixelToTile(evt.layerX, evt.layerY, boardw, boardh, clamp);
				 if (buttonDown && highlight)
					 {
						 preventClick = true;
						 board[highlight.tilex][highlight.tiley] = 1;
					 }

			 }, false);


		 function getAdjacentCells(cellX, cellY, boardw, boardh)
		 {
			 var adjList = [];
			 if (cellY % 2)
				 {
					 adjList = [
						 {x: cellX    , y: cellY - 1, m: 1},
						 {x: cellX - 1, y: cellY    , m: 1},
						 {x: cellX    , y: cellY + 1, m: 1},
						 {x: cellX + 1, y: cellY - 1, m: 1},
						 {x: cellX + 1, y: cellY    , m: 1},
						 {x: cellX + 1, y: cellY + 1, m: 1},
						 
						 /*
							{x: cellX    , y: cellY - 2, m: 0.3},
							{x: cellX - 1, y: cellY - 1, m: 0.3},
							{x: cellX + 2, y: cellY - 1, m: 0.3},
							{x: cellX - 1, y: cellY + 1, m: 0.3},
							{x: cellX + 2, y: cellY + 1, m: 0.3},
							{x: cellX    , y: cellY + 2, m: 0.3},*/
						 
					 ]
				 }
			 else
				 {
					 adjList = [
						 {x: cellX - 1, y: cellY - 1, m: 1},
						 {x: cellX - 1, y: cellY    , m: 1},
						 {x: cellX - 1, y: cellY + 1, m: 1},
						 {x: cellX    , y: cellY - 1, m: 1},
						 {x: cellX + 1, y: cellY    , m: 1},
						 {x: cellX    , y: cellY + 1, m: 1},
						 /*
							{x: cellX    , y: cellY - 2, m: 0.3},
							{x: cellX - 2, y: cellY - 1, m: 0.3},
							{x: cellX + 1, y: cellY - 1, m: 0.3},
							{x: cellX - 2, y: cellY + 1, m: 0.3},
							{x: cellX + 1, y: cellY + 1, m: 0.3},
							{x: cellX    , y: cellY + 2, m: 0.3},*/
					 ]
				 }

			 var filtered = [];
			 var i = 0;
			 for (i=0; i<adjList.length; i++)
				 {
					 adjList[i].x = wrap(adjList[i].x, boardw);
					 adjList[i].y = wrap(adjList[i].y, boardh);
					 
					 filtered.push(adjList[i]);
				 }
			 return filtered;
		 }

		 var update = false;
		 var refresher = false;

		 calcbutton.addEventListener('click', function(evt)
			 {
				 if (!refresher)
					 {
						 refresher = setInterval(function()
							 {
								 update = true;
							 }, 100);
					 }
			 }, false);

		 setInterval(function()
			 {
				 context.fillStyle = "#000";
				 context.fillRect(0, 0, w, h);

				 if (update)
					 {
						 // calculate
						 for(i=0; i<boardw; i++)
							 {
								 for(j=0; j<boardh; j++)
									 {

										 if (board[i][j] == 0)
											 {
												 document.getElementById("coordinates").value += i + ',' + j + ';';
											 }
									 }
							 }
						 update = false;
					 }
				 // render
				 var i=0,j=0;
				 for(i=0; i<boardw; i++)
					 {
						 for(j=0; j<boardh; j++)
							 {
								 var x = i * 16 + (j % 2) * 8;
								 var y = j * 14;
								 var hex = emptyHexImage;
								 if (board[i][j])
									 {
										 hex = filledHexImages[ (board[i][j]-1)  % filledHexImages.length];
									 }
								 context.drawImage(hex, x, y);
							 }
					 }
				 
				 if (highlight)
					 {
						 context.drawImage(highlightHexImage, highlight.x, highlight.y);
					 }
				 
			 }, 16)
		 
		</script>

		
	</body>
</html>
